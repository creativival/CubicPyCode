# ç¬¬7å›ï¼š3Dãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œã‚ã†

![CubicPy Logo](https://creativival.github.io/CubicPy/assets/cubicpy_logo.png)

## ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³
**è‡ªåˆ†ã ã‘ã®ãƒœãƒ¼ãƒªãƒ³ã‚°å ´ã‚’ä½œã£ã¦ã€æœ¬æ ¼çš„ãª3Dãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã—ã‚ˆã†ï¼**

## å‰å›ã®ãŠã•ã‚‰ã„

å‰å›ã¯ã€ŒAPIãƒ¢ãƒ¼ãƒ‰ã§ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ï¼ã€ã¨é¡Œã—ã¦ã€CubicPyã®é«˜åº¦ãªæ©Ÿèƒ½ã‚’å­¦ã³ã¾ã—ãŸã€‚APIãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã“ã¨ã§ã€ã‚ˆã‚Šè‡ªç”±åº¦ã®é«˜ã„3Dä¸–ç•Œã‚’ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ã€‚ä»Šå›ã¯ãã®çŸ¥è­˜ã‚’æ´»ã‹ã—ã¦ã€æœ¬æ ¼çš„ãª3Dãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã„ãã¾ã—ã‚‡ã†ï¼

## ãƒœãƒ¼ãƒªãƒ³ã‚°ã®ãƒ«ãƒ¼ãƒ«ã¨ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³

ã¾ãšã¯ã€ãƒœãƒ¼ãƒªãƒ³ã‚°ã®åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã‚’ãŠã•ã‚‰ã„ã—ã¾ã—ã‚‡ã†ã€‚

### ãƒœãƒ¼ãƒªãƒ³ã‚°ã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«

1. **ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹æˆ**: ãƒœãƒ¼ãƒªãƒ³ã‚°ã¯10ãƒ•ãƒ¬ãƒ¼ãƒ ã§æ§‹æˆã•ã‚Œã‚‹
2. **ãƒ”ãƒ³é…ç½®**: 10æœ¬ã®ãƒ”ãƒ³ãŒä¸‰è§’å½¢çŠ¶ã«é…ç½®ã•ã‚Œã‚‹
3. **å¾—ç‚¹è¨ˆç®—**:
   - ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ï¼ˆ1æŠ•ç›®ã§10æœ¬å…¨ã¦å€’ã—ãŸï¼‰: 10ç‚¹ + æ¬¡ã®2æŠ•ã®ç‚¹æ•°
   - ã‚¹ãƒšã‚¢ï¼ˆ2æŠ•ã§10æœ¬å…¨ã¦å€’ã—ãŸï¼‰: 10ç‚¹ + æ¬¡ã®1æŠ•ã®ç‚¹æ•°
   - ã‚ªãƒ¼ãƒ—ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ2æŠ•ã—ã¦ã‚‚å…¨ã¦å€’ã›ãªã‹ã£ãŸï¼‰: å€’ã—ãŸæœ¬æ•°ãŒå¾—ç‚¹

### ã‚²ãƒ¼ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³

ã‚·ãƒ³ãƒ—ãƒ«ãªãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‹ã‚‰å§‹ã‚ã¦ã€å¾ã€…ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

1. **ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰**: 1ãƒ•ãƒ¬ãƒ¼ãƒ ã€6æœ¬ã®ãƒ”ãƒ³ã€åŸºæœ¬çš„ãªã‚¹ã‚³ã‚¢è¨ˆç®—
2. **ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰**: 10ãƒ•ãƒ¬ãƒ¼ãƒ ã€10æœ¬ã®ãƒ”ãƒ³ã€æœ¬æ ¼çš„ãªã‚¹ã‚³ã‚¢è¨ˆç®—
3. **ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰**: ç‹¬è‡ªã®ãƒ”ãƒ³é…ç½®ã€éšœå®³ç‰©ã€ç‰¹æ®ŠåŠ¹æœãªã©ã®è¿½åŠ 

ä»Šå›ã¯ã€ã¾ãšãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’å®Œæˆã•ã›ã¦ã€å¾ã€…ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

## ãƒœãƒ¼ãƒªãƒ³ã‚°ãƒ”ãƒ³ã®é…ç½®ã¨ãƒœãƒ¼ãƒ«ã®å‹•ã

ã¾ãšã¯åŸºæœ¬çš„ãªãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’bowling_game.py ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚

```python
from cubicpy import CubicPyApp
import threading
import time
import math

class BowlingGame(CubicPyApp):
    """ãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸCubicPyAppã®æ‹¡å¼µã‚¯ãƒ©ã‚¹"""
    
    def __init__(self):
        """ãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–"""
        # è¦ªã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‘¼ã³å‡ºã—
        super().__init__(gravity_factor=1)
        
        # ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°
        self.score = 0
        self.pins_knocked_down = 0
        self.pins = []
        self.initial_pin_positions = []
        self.balls_thrown = 0
        self.max_balls = 2  # 1ãƒ•ãƒ¬ãƒ¼ãƒ ã§æŠ•ã’ã‚‰ã‚Œã‚‹ãƒœãƒ¼ãƒ«ã®æ•°
        self.current_frame = 1
        self.max_frames = 10
        self.frame_scores = [0] * self.max_frames
        
        # ã‚¹ãƒ¬ãƒƒãƒ‰é–¢é€£ã®è¨­å®š
        self.game_thread = None
        self.running = False
        self.last_update_time = 0
        
        # ãƒ”ãƒ³é…ç½®ã®å®šç¾©ï¼ˆæ¨™æº–çš„ãª10ãƒ”ãƒ³é…ç½®ï¼‰
        self.pin_positions = [
            (0, 0, 0),           # 1ç•ªãƒ”ãƒ³ï¼ˆå…ˆé ­ï¼‰
            (-1, 1, 0), (1, 1, 0),        # 2-3ç•ªãƒ”ãƒ³
            (-2, 2, 0), (0, 2, 0), (2, 2, 0),  # 4-6ç•ªãƒ”ãƒ³
            (-3, 3, 0), (-1, 3, 0), (1, 3, 0), (3, 3, 0),  # 7-10ç•ªãƒ”ãƒ³
        ]
        
        # æœ€å¤§ã‚¹ã‚³ã‚¢ã‚’è¨­å®š
        self.max_score = len(self.pin_positions)
        
        # ãƒ¬ãƒ¼ãƒ³è¨­å®š
        self.lane_length = 30  # ãƒ¬ãƒ¼ãƒ³ã®é•·ã•
        self.lane_width = 8    # ãƒ¬ãƒ¼ãƒ³ã®å¹…
        
        # ã‚²ãƒ¼ãƒ ã®åˆæœŸè¨­å®š
        self.setup_game()
    
    def setup_game(self):
        """ã‚²ãƒ¼ãƒ ã®åˆæœŸè¨­å®š"""
        # ãƒœã‚¦ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒ³ï¼ˆåºŠï¼‰ã‚’ä½œæˆ
        self.add_cube(
            position=(0, self.lane_length/2 - 5, -0.1),  # å°‘ã—æ‰‹å‰ã«é…ç½®
            scale=(self.lane_width, self.lane_length, 0.2),
            color=(0.9, 0.7, 0.5),  # æœ¨ç›®èª¿ã®è‰²
            mass=0  # å‹•ã‹ãªã„ã‚ˆã†ã«å›ºå®š
        )
        
        # ã‚¬ã‚¿ãƒ¼ã‚’ä½œæˆï¼ˆå·¦å³ï¼‰
        for x_offset in [-self.lane_width/2 - 0.5, self.lane_width/2 + 0.5]:
            self.add_cube(
                position=(x_offset, self.lane_length/2 - 5, 0.3),
                scale=(0.5, self.lane_length, 0.8),
                color=(0.3, 0.3, 0.3),  # æš—ã„è‰²
                mass=0  # å‹•ã‹ãªã„ã‚ˆã†ã«å›ºå®š
            )
        
        # ãƒ”ãƒ³ã‚’é…ç½®
        self.setup_pins()
        
        # ãƒœãƒ¼ãƒ«ã‚’ä½œæˆ
        self.create_ball()
        
        # ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
        self.set_top_left_text('3Dãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ  - ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ãƒœãƒ¼ãƒ«ã‚’ç™ºå°„ï¼')
        self.set_bottom_left_text(f"ãƒ•ãƒ¬ãƒ¼ãƒ : {self.current_frame}/{self.max_frames}  æŠ•çƒ: {self.balls_thrown+1}/{self.max_balls}")
    
    def setup_pins(self):
        """ãƒ”ãƒ³ã‚’é…ç½®"""
        # æ—¢å­˜ã®ãƒ”ãƒ³ã‚’ã‚¯ãƒªã‚¢
        self.pins.clear()
        self.initial_pin_positions.clear()
        
        # ãƒ”ãƒ³ã‚’é…ç½®
        for i, pos in enumerate(self.pin_positions):
            pin = self.add_cylinder(
                position=(pos[0], pos[1], 1.6),  # é«˜ã•ã‚’èª¿æ•´
                scale=(0.8, 0.8, 3.2),
                color=(1, 1, 1),  # ç™½
                base_point=1,     # åº•é¢ä¸­å¿ƒ
            )
            # ãƒ”ãƒ³ã®å‚ç…§ã¨åˆæœŸä½ç½®ã‚’ä¿å­˜
            self.pins.append(pin)
            self.initial_pin_positions.append(pos)
    
    def create_ball(self):
        """ãƒœãƒ¼ãƒ«ã‚’ä½œæˆ"""
        self.ball = self.add_sphere(
            position=(0, -self.lane_length/2 + 5, 1.2),  # ãƒ¬ãƒ¼ãƒ³ã®æ‰‹å‰ã«é…ç½®
            scale=(1.2, 1.2, 1.2),
            color=(0.3, 0.3, 0.8),  # é’
            mass=10,
            base_point=1,          # åº•é¢ä¸­å¿ƒ
        )
    
    def throw_ball(self, angle=0, power=10):
        """ãƒœãƒ¼ãƒ«ã‚’æŠ•ã’ã‚‹"""
        # è§’åº¦ã«å¿œã˜ãŸæ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—
        angle_rad = math.radians(angle)
        direction_x = math.sin(angle_rad) * power
        direction_y = math.cos(angle_rad) * power
        
        # ãƒœãƒ¼ãƒ«ã«åˆé€Ÿåº¦ã‚’è¨­å®š
        self.add_sphere(
            position=(0, -self.lane_length/2 + 5, 1.2),  # ãƒ¬ãƒ¼ãƒ³ã®æ‰‹å‰ã«é…ç½®
            scale=(1.2, 1.2, 1.2),
            color=(0.3, 0.3, 0.8),  # é’
            mass=10,
            velocity=(direction_x, direction_y, 0),  # æ–¹å‘ã¨åŠ›ã«å¿œã˜ãŸåˆé€Ÿåº¦
            base_point=1,          # åº•é¢ä¸­å¿ƒ
        )
        
        # ãƒœãƒ¼ãƒ«ã‚’æŠ•ã’ãŸå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        self.balls_thrown += 1
        
        # ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºæ›´æ–°
        self.set_bottom_left_text(f"ãƒ•ãƒ¬ãƒ¼ãƒ : {self.current_frame}/{self.max_frames}  æŠ•çƒ: {self.balls_thrown}/{self.max_balls}")
        
        # ãƒœãƒ¼ãƒ«ã‚’ç™ºå°„
        self.launch_objects()
    
    def start_game_logic(self):
        """ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹å§‹"""
        if self.running:
            return
            
        self.running = True
        self.game_thread = threading.Thread(target=self._run_game_logic)
        self.game_thread.daemon = True
        self.game_thread.start()
    
    def stop_game_logic(self):
        """ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åœæ­¢"""
        self.running = False
        if self.game_thread:
            self.game_thread.join(timeout=1.0)
            self.game_thread = None
    
    def get_knocked_pins_count(self):
        """å€’ã‚ŒãŸãƒ”ãƒ³ã®æ•°ã‚’å–å¾—"""
        try:
            count = 0
            for i, pin in enumerate(self.pins):
                # ãƒ”ãƒ³ãŒå‹•ã„ãŸã‹ãƒã‚§ãƒƒã‚¯
                initial_pos = self.initial_pin_positions[i]
                
                # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ã‹ã‚‰ç¾åœ¨ä½ç½®ã‚’å–å¾—
                # æ³¨: WorldManagerã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒªã‚¹ãƒˆã‹ã‚‰æ¢ã™å¿…è¦ãŒã‚ã‚‹
                for obj in self.world_manager.body_objects:
                    if obj['type'] == 'cylinder' and obj['object'] == pin:
                        current_pos = obj['object'].cylinder_node.getPos()
                        current_hpr = obj['object'].cylinder_node.getHpr()
                        
                        # ä½ç½®ã¨å›è»¢ã®å·®ã‚’è¨ˆç®—
                        dx = abs(current_pos.x - initial_pos[0])
                        dy = abs(current_pos.y - initial_pos[1])
                        
                        # å‚¾ãã‚’è¨ˆç®—
                        dh = abs(current_hpr.x) % 360
                        dp = abs(current_hpr.y) % 360
                        
                        # 180åº¦ã‚’è¶…ãˆã‚‹å ´åˆã¯å°ã•ã„æ–¹ã®è§’åº¦ã‚’ä½¿ç”¨
                        if dh > 180: dh = 360 - dh
                        if dp > 180: dp = 360 - dp
                        
                        # ä½ç½®ãŒå¤§ããå¤‰ã‚ã£ãŸã‹ã€å‚¾ããŒå¤§ãã„å ´åˆã¯å€’ã‚ŒãŸã¨åˆ¤æ–­
                        if dx > 0.5 or dy > 0.5 or dh > 45 or dp > 45:
                            count += 1
                        
                        break
            
            return count
        except Exception as e:
            print(f"ãƒ”ãƒ³æ•°ã®è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼: {e}")
            return 0
    
    def update_score(self):
        """ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°"""
        knocked_pins = self.get_knocked_pins_count()
        
        if knocked_pins > self.pins_knocked_down:
            self.pins_knocked_down = knocked_pins
            
            # ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
            self.frame_scores[self.current_frame - 1] = knocked_pins
            
            # ç”»é¢è¡¨ç¤ºã‚’æ›´æ–°
            self.set_top_left_text(f'3Dãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ  - å€’ã—ãŸãƒ”ãƒ³: {knocked_pins}/{self.max_score}')
            
            # ã™ã¹ã¦ã®ãƒ”ãƒ³ã‚’å€’ã—ãŸå ´åˆï¼ˆã‚¹ãƒˆãƒ©ã‚¤ã‚¯ï¼‰
            if knocked_pins == self.max_score:
                self.set_top_left_text(f'ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ï¼ å…¨éƒ¨å€’ã—ãŸï¼ {knocked_pins}/{self.max_score}')
            # åŠåˆ†ä»¥ä¸Šå€’ã—ãŸå ´åˆ
            elif knocked_pins > self.max_score // 2:
                self.set_top_left_text(f'ãƒŠã‚¤ã‚¹ï¼ {knocked_pins}/{self.max_score}')
    
    def next_ball(self):
        """æ¬¡ã®æŠ•çƒã«é€²ã‚€"""
        # å…¨ã¦ã®ãƒ”ãƒ³ã‚’å€’ã—ãŸå ´åˆã€ã¾ãŸã¯2æŠ•ç›®ã®å ´åˆã¯æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã¸
        if self.pins_knocked_down == self.max_score or self.balls_thrown >= self.max_balls:
            self.next_frame()
        else:
            # ãƒœãƒ¼ãƒ«ã®ã¿ãƒªã‚»ãƒƒãƒˆ
            self.create_ball()
    
    def next_frame(self):
        """æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã«é€²ã‚€"""
        self.current_frame += 1
        self.balls_thrown = 0
        self.pins_knocked_down = 0
        
        # ã‚²ãƒ¼ãƒ çµ‚äº†ãƒã‚§ãƒƒã‚¯
        if self.current_frame > self.max_frames:
            self.set_top_left_text(f'ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ æœ€çµ‚ã‚¹ã‚³ã‚¢: {sum(self.frame_scores)}')
            self.set_bottom_left_text(f"å…¨ãƒ•ãƒ¬ãƒ¼ãƒ çµ‚äº†ï¼ Rã‚­ãƒ¼ã§ãƒªã‚»ãƒƒãƒˆ")
            return
        
        # ãƒ”ãƒ³ã¨ãƒœãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
        self.setup_pins()
        self.create_ball()
        
        # è¡¨ç¤ºæ›´æ–°
        self.set_bottom_left_text(f"ãƒ•ãƒ¬ãƒ¼ãƒ : {self.current_frame}/{self.max_frames}  æŠ•çƒ: {self.balls_thrown+1}/{self.max_balls}")
    
    def _run_game_logic(self):
        """å†…éƒ¨ã‚¹ãƒ¬ãƒƒãƒ‰ã®å®Ÿè¡Œé–¢æ•°"""
        ball_stopped_counter = 0
        last_ball_position = None
        
        while self.running:
            try:
                # ç¾åœ¨ã®æ™‚åˆ»ã‚’å–å¾—ï¼ˆæ›´æ–°ã®é–“éš”èª¿æ•´ç”¨ï¼‰
                current_time = time.time()
                
                # ä¸€å®šé–“éš”ã§ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ˆè² è·è»½æ¸›ã®ãŸã‚ï¼‰
                if current_time - self.last_update_time > 0.2:  # 0.2ç§’é–“éš”
                    self.update_score()
                    
                    # ãƒœãƒ¼ãƒ«ã®ä½ç½®ã‚’å–å¾—
                    ball_position = None
                    for obj in self.world_manager.body_objects:
                        if obj['type'] == 'sphere':
                            ball_position = obj['object'].sphere_node.getPos()
                            break
                    
                    # ãƒœãƒ¼ãƒ«ãŒåœæ­¢ã—ãŸã‹ãƒã‚§ãƒƒã‚¯
                    if ball_position and last_ball_position:
                        # ãƒœãƒ¼ãƒ«ã®ç§»å‹•è·é›¢ãŒå°ã•ã„å ´åˆã€åœæ­¢ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¢—åŠ 
                        dx = abs(ball_position.x - last_ball_position.x)
                        dy = abs(ball_position.y - last_ball_position.y)
                        dz = abs(ball_position.z - last_ball_position.z)
                        
                        if dx < 0.01 and dy < 0.01 and dz < 0.01:
                            ball_stopped_counter += 1
                        else:
                            ball_stopped_counter = 0
                    
                    # ãƒœãƒ¼ãƒ«ãŒ3ç§’é–“åœæ­¢ã—ãŸã‚‰æ¬¡ã®æŠ•çƒã¸
                    if ball_stopped_counter >= 15:  # 0.2ç§’ x 15 = 3ç§’
                        self.next_ball()
                        ball_stopped_counter = 0
                    
                    last_ball_position = ball_position
                    self.last_update_time = current_time
                
                time.sleep(0.05)  # çŸ­ã„å¾…æ©Ÿæ™‚é–“ã§CPUè² è·ã‚’æŠ‘ãˆã‚‹
                
            except Exception as e:
                print(f"ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼: {e}")
                time.sleep(1)  # ã‚¨ãƒ©ãƒ¼æ™‚ã¯é•·ã‚ã«å¾…æ©Ÿ
    
    def reset_game(self):
        """ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ"""
        self.current_frame = 1
        self.balls_thrown = 0
        self.pins_knocked_down = 0
        self.frame_scores = [0] * self.max_frames
        
        # ãƒ”ãƒ³ã¨ãƒœãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
        self.setup_pins()
        self.create_ball()
        
        # è¡¨ç¤ºæ›´æ–°
        self.set_top_left_text('3Dãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ  - ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ãƒœãƒ¼ãƒ«ã‚’ç™ºå°„ï¼')
        self.set_bottom_left_text(f"ãƒ•ãƒ¬ãƒ¼ãƒ : {self.current_frame}/{self.max_frames}  æŠ•çƒ: {self.balls_thrown+1}/{self.max_balls}")
    
    def run(self, key_handler=None):
        """ã‚²ãƒ¼ãƒ ã‚’å®Ÿè¡Œ"""
        try:
            # ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
            if key_handler:
                self.set_key_handler(key_handler)
            else:
                # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®š
                self.set_key_handler(self.default_key_handler)
            
            # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®é–‹å§‹
            self.start_game_logic()
            
            # è¦ªã‚¯ãƒ©ã‚¹ã®run()ã‚’å‘¼ã³å‡ºã—
            super().run()
        finally:
            # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®åœæ­¢
            self.stop_game_logic()
    
    def default_key_handler(self, key):
        """ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©"""
        if key == 'space':
            # ãƒœãƒ¼ãƒ«ã‚’æŠ•ã’ã‚‹
            if self.balls_thrown < self.max_balls and self.current_frame <= self.max_frames:
                self.throw_ball()
        elif key == 'r':
            # ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            self.reset_game()


# ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œéƒ¨åˆ†
if __name__ == "__main__":
    # ãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œæˆ
    game = BowlingGame()
    
    # ã‚²ãƒ¼ãƒ å®Ÿè¡Œ
    game.run()
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ã€åŸºæœ¬çš„ãªãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®æ çµ„ã¿ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ä¸»ãªæ©Ÿèƒ½ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

1. **ãƒœã‚¦ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒ³ã®ä½œæˆ**: ãƒ¬ãƒ¼ãƒ³ã¨ã‚¬ã‚¿ãƒ¼ã‚’é…ç½®
2. **ãƒ”ãƒ³ã®é…ç½®**: æ¨™æº–çš„ãª10ãƒ”ãƒ³é…ç½®
3. **ãƒœãƒ¼ãƒ«ã®å‹•ã**: è§’åº¦ã¨ãƒ‘ãƒ¯ãƒ¼ã‚’èª¿æ•´ã—ã¦æŠ•ã’ã‚‰ã‚Œã‚‹
4. **ã‚¹ã‚³ã‚¢è¨ˆç®—**: å€’ã‚ŒãŸãƒ”ãƒ³ã‚’æ¤œå‡ºã—ã¦å¾—ç‚¹ã‚’è¨ˆç®—
5. **ã‚²ãƒ¼ãƒ é€²è¡Œ**: ãƒ•ãƒ¬ãƒ¼ãƒ ã¨æŠ•çƒã‚’ç®¡ç†

### ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

#### ãƒ”ãƒ³ã®é…ç½®

ãƒ”ãƒ³ã¯ä¸‰è§’å½¢çŠ¶ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ãƒ”ãƒ³ã®ä½ç½®ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```python
# ãƒ”ãƒ³é…ç½®ã®å®šç¾©ï¼ˆæ¨™æº–çš„ãª10ãƒ”ãƒ³é…ç½®ï¼‰
self.pin_positions = [
    (0, 0, 0),           # 1ç•ªãƒ”ãƒ³ï¼ˆå…ˆé ­ï¼‰
    (-1, 1, 0), (1, 1, 0),        # 2-3ç•ªãƒ”ãƒ³
    (-2, 2, 0), (0, 2, 0), (2, 2, 0),  # 4-6ç•ªãƒ”ãƒ³
    (-3, 3, 0), (-1, 3, 0), (1, 3, 0), (3, 3, 0),  # 7-10ç•ªãƒ”ãƒ³
]
```

#### ãƒœãƒ¼ãƒ«ã®å‹•ã

ãƒœãƒ¼ãƒ«ã¯`throw_ball`ãƒ¡ã‚½ãƒƒãƒ‰ã§æŠ•ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è§’åº¦ã¨ãƒ‘ãƒ¯ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã‚Œã«å¿œã˜ãŸæ–¹å‘ã¨é€Ÿåº¦ã§ãƒœãƒ¼ãƒ«ãŒç™ºå°„ã•ã‚Œã¾ã™ã€‚

```python
def throw_ball(self, angle=0, power=10):
    """ãƒœãƒ¼ãƒ«ã‚’æŠ•ã’ã‚‹"""
    # è§’åº¦ã«å¿œã˜ãŸæ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—
    angle_rad = math.radians(angle)
    direction_x = math.sin(angle_rad) * power
    direction_y = math.cos(angle_rad) * power
    
    # ãƒœãƒ¼ãƒ«ã«åˆé€Ÿåº¦ã‚’è¨­å®š
    self.add_sphere(
        position=(0, -self.lane_length/2 + 5, 1.2),  # ãƒ¬ãƒ¼ãƒ³ã®æ‰‹å‰ã«é…ç½®
        scale=(1.2, 1.2, 1.2),
        color=(0.3, 0.3, 0.8),  # é’
        mass=10,
        velocity=(direction_x, direction_y, 0),  # æ–¹å‘ã¨åŠ›ã«å¿œã˜ãŸåˆé€Ÿåº¦
        base_point=1,          # åº•é¢ä¸­å¿ƒ
    )
    
    # ãƒœãƒ¼ãƒ«ã‚’ç™ºå°„
    self.launch_objects()
```

#### å€’ã‚ŒãŸãƒ”ãƒ³ã®æ¤œå‡º

ãƒ”ãƒ³ãŒå€’ã‚ŒãŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ãŸã‚ã«ã€ä½ç½®ã¨å‚¾ãã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™ã€‚

```python
def get_knocked_pins_count(self):
    """å€’ã‚ŒãŸãƒ”ãƒ³ã®æ•°ã‚’å–å¾—"""
    try:
        count = 0
        for i, pin in enumerate(self.pins):
            # ãƒ”ãƒ³ãŒå‹•ã„ãŸã‹ãƒã‚§ãƒƒã‚¯
            initial_pos = self.initial_pin_positions[i]
            
            # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ã‹ã‚‰ç¾åœ¨ä½ç½®ã‚’å–å¾—
            for obj in self.world_manager.body_objects:
                if obj['type'] == 'cylinder' and obj['object'] == pin:
                    current_pos = obj['object'].cylinder_node.getPos()
                    current_hpr = obj['object'].cylinder_node.getHpr()
                    
                    # ä½ç½®ã¨å›è»¢ã®å·®ã‚’è¨ˆç®—
                    dx = abs(current_pos.x - initial_pos[0])
                    dy = abs(current_pos.y - initial_pos[1])
                    
                    # å‚¾ãã‚’è¨ˆç®—
                    dh = abs(current_hpr.x) % 360
                    dp = abs(current_hpr.y) % 360
                    
                    # 180åº¦ã‚’è¶…ãˆã‚‹å ´åˆã¯å°ã•ã„æ–¹ã®è§’åº¦ã‚’ä½¿ç”¨
                    if dh > 180: dh = 360 - dh
                    if dp > 180: dp = 360 - dp
                    
                    # ä½ç½®ãŒå¤§ããå¤‰ã‚ã£ãŸã‹ã€å‚¾ããŒå¤§ãã„å ´åˆã¯å€’ã‚ŒãŸã¨åˆ¤æ–­
                    if dx > 0.5 or dy > 0.5 or dh > 45 or dp > 45:
                        count += 1
                    
                    break
        
        return count
    except Exception as e:
        print(f"ãƒ”ãƒ³æ•°ã®è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼: {e}")
        return 0
```

## ã‚¹ã‚³ã‚¢è¨ˆç®—ã¨ã‚²ãƒ¼ãƒ ã®é€²è¡Œ

ãƒœãƒ¼ãƒªãƒ³ã‚°ã®ã‚¹ã‚³ã‚¢è¨ˆç®—ã«ã¯ã„ãã¤ã‹ã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚åŸºæœ¬çš„ãªã‚¹ã‚³ã‚¢è¨ˆç®—ã¨ã€ã‚²ãƒ¼ãƒ ã®é€²è¡Œã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ã‚¹ã‚³ã‚¢è¨ˆç®—ã®å®Ÿè£…

ã‚¹ã‚³ã‚¢è¨ˆç®—ã‚’ã•ã‚‰ã«æœ¬æ ¼çš„ã«ã™ã‚‹ã«ã¯ã€ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ã¨ã‚¹ãƒšã‚¢ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```python
def calculate_score(self):
    """ã™ã¹ã¦ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—"""
    total_score = 0
    running_score = 0
    
    for i in range(self.max_frames):
        if i >= self.current_frame:
            break
            
        frame_score = self.frame_scores[i]
        
        # ã‚¹ãƒˆãƒ©ã‚¤ã‚¯ï¼ˆ1æŠ•ç›®ã§10æœ¬å…¨ã¦å€’ã—ãŸï¼‰
        if frame_score == self.max_score and self.balls_thrown == 1:
            # ãƒœãƒ¼ãƒŠã‚¹: æ¬¡ã®2æŠ•ã®ç‚¹æ•°ã‚’åŠ ç®—
            # æ³¨: ç°¡æ˜“ç‰ˆãªã®ã§ã€æ¬¡ã®2æŠ•ãŒåˆ¥ãƒ•ãƒ¬ãƒ¼ãƒ ã«ãªã‚‹å ´åˆã¯è€ƒæ…®ã—ã¦ã„ãªã„
            bonus = 0
            if i + 1 < self.max_frames:
                bonus += self.frame_scores[i + 1]
            frame_score += bonus
        
        # ã‚¹ãƒšã‚¢ï¼ˆ2æŠ•ã§10æœ¬å…¨ã¦å€’ã—ãŸï¼‰
        elif frame_score == self.max_score and self.balls_thrown == 2:
            # ãƒœãƒ¼ãƒŠã‚¹: æ¬¡ã®1æŠ•ã®ç‚¹æ•°ã‚’åŠ ç®—
            bonus = 0
            if i + 1 < self.max_frames:
                # æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®1æŠ•ç›®ã®ã¿ã‚’è€ƒæ…®
                bonus += min(self.frame_scores[i + 1], self.max_score // 2)
            frame_score += bonus
        
        running_score += frame_score
        total_score = running_score
    
    return total_score
```

### ã‚²ãƒ¼ãƒ é€²è¡Œã®æ”¹è‰¯

ã‚ˆã‚Šæœ¬æ ¼çš„ãªã‚²ãƒ¼ãƒ é€²è¡Œã®ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚

```python
def show_score_board(self):
    """ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤º"""
    score_text = f"ãƒ•ãƒ¬ãƒ¼ãƒ : {self.current_frame}/{self.max_frames}  "
    score_text += f"æŠ•çƒ: {self.balls_thrown+1}/{self.max_balls}  "
    score_text += f"ã‚¹ã‚³ã‚¢: {self.calculate_score()}"
    
    self.set_bottom_left_text(score_text)
    
    # è©³ç´°ãªã‚¹ã‚³ã‚¢è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    if hasattr(self, 'detailed_score_text'):
        detailed_text = "ãƒ•ãƒ¬ãƒ¼ãƒ åˆ¥ã‚¹ã‚³ã‚¢: "
        for i in range(self.current_frame):
            if i < len(self.frame_scores):
                detailed_text += f"[{i+1}]:{self.frame_scores[i]} "
        self.detailed_score_text.setText(detailed_text)
```

## å¿œç”¨ç·¨ï¼š3Dãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®æ‹¡å¼µ

åŸºæœ¬çš„ãªãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ãŒã§ããŸã®ã§ã€ã•ã‚‰ã«æ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### è§’åº¦ã¨ãƒ‘ãƒ¯ãƒ¼ã®èª¿æ•´

ã‚ˆã‚Šæœ¬æ ¼çš„ãªãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ä½“é¨“ã®ãŸã‚ã«ã€ãƒœãƒ¼ãƒ«ã®è§’åº¦ã¨ãƒ‘ãƒ¯ãƒ¼ã‚’èª¿æ•´ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„ï¼š

```python
def setup_game(self):
    """ã‚²ãƒ¼ãƒ ã®åˆæœŸè¨­å®š"""
    # æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰...
    
    # æŠ•çƒã®è¨­å®š
    self.throw_angle = 0  # åˆæœŸè§’åº¦ï¼ˆåº¦ï¼‰
    self.throw_power = 10  # åˆæœŸãƒ‘ãƒ¯ãƒ¼
    
    # çŸ¢å°è¡¨ç¤ºï¼ˆæ–¹å‘æŒ‡ç¤ºå™¨ï¼‰
    self.direction_indicator = self.add_cube(
        position=(0, -self.lane_length/2 + 3, 0.1),
        scale=(0.2, 2, 0.1),
        color=(1, 0, 0),  # èµ¤
        mass=0  # å‹•ã‹ãªã„ã‚ˆã†ã«
    )
    
    # ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
    self.set_top_left_text('3Dãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ  - ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ãƒœãƒ¼ãƒ«ã‚’ç™ºå°„ï¼')
    self.set_bottom_left_text(f"ãƒ•ãƒ¬ãƒ¼ãƒ : {self.current_frame}/{self.max_frames}  æŠ•çƒ: {self.balls_thrown+1}/{self.max_balls}")
    
    # ãƒ‘ãƒ¯ãƒ¼ã¨è§’åº¦ã®è¡¨ç¤º
    self.power_angle_text = Draw2DText(self.font, self.a2dBottomRight, 
                                      f"è§’åº¦: {self.throw_angle}Â° ãƒ‘ãƒ¯ãƒ¼: {self.throw_power}",
                                      pos=(-1.0, 0.1))

def default_key_handler(self, key):
    """ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚­ãƒ¼ãƒãƒ³ãƒ‰ãƒ©"""
    if key == 'space':
        # ãƒœãƒ¼ãƒ«ã‚’æŠ•ã’ã‚‹
        if self.balls_thrown < self.max_balls and self.current_frame <= self.max_frames:
            self.throw_ball(self.throw_angle, self.throw_power)
    elif key == 'r':
        # ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
        self.reset_game()
    elif key == 'left' or key == 'a':
        # å·¦ã«è§’åº¦ã‚’èª¿æ•´
        self.throw_angle = max(self.throw_angle - 5, -45)
        self.update_direction_indicator()
    elif key == 'right' or key == 'd':
        # å³ã«è§’åº¦ã‚’èª¿æ•´
        self.throw_angle = min(self.throw_angle + 5, 45)
        self.update_direction_indicator()
    elif key == 'up' or key == 'w':
        # ãƒ‘ãƒ¯ãƒ¼ã‚’ä¸Šã’ã‚‹
        self.throw_power = min(self.throw_power + 1, 20)
        self.update_power_angle_display()
    elif key == 'down' or key == 's':
        # ãƒ‘ãƒ¯ãƒ¼ã‚’ä¸‹ã’ã‚‹
        self.throw_power = max(self.throw_power - 1, 5)
        self.update_power_angle_display()

def update_direction_indicator(self):
    """æ–¹å‘æŒ‡ç¤ºå™¨ã®å›è»¢ã‚’æ›´æ–°"""
    if hasattr(self, 'direction_indicator'):
        self.direction_indicator.setH(self.throw_angle)
        self.update_power_angle_display()

def update_power_angle_display(self):
    """ãƒ‘ãƒ¯ãƒ¼ã¨è§’åº¦ã®è¡¨ç¤ºã‚’æ›´æ–°"""
    if hasattr(self, 'power_angle_text'):
        self.power_angle_text.setText(f"è§’åº¦: {self.throw_angle}Â° ãƒ‘ãƒ¯ãƒ¼: {self.throw_power}")
```

### ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾å¿œ

è¤‡æ•°äººã§ãƒ—ãƒ¬ã‚¤ã§ãã‚‹ã‚ˆã†ã«ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```python
def __init__(self):
    """ãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–"""
    # è¦ªã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‘¼ã³å‡ºã—
    super().__init__(gravity_factor=1)
    
    # ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°
    self.players = ["ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1", "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2"]  # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å
    self.current_player = 0  # ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    
    # å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¹ã‚³ã‚¢ã‚’ç®¡ç†
    self.player_scores = []
    for _ in range(len(self.players)):
        self.player_scores.append([0] * self.max_frames)
    
    # ä»–ã®åˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰...

```python
def next_player(self):
    """æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ"""
    self.current_player = (self.current_player + 1) % len(self.players)
    
    # è¡¨ç¤ºã‚’æ›´æ–°
    self.set_top_left_text(f"{self.players[self.current_player]}ã®ç•ª - ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§ãƒœãƒ¼ãƒ«ã‚’ç™ºå°„ï¼")
    self.show_score_board()
```

## ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼šã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒœãƒ¼ãƒªãƒ³ã‚°å ´ã‚’ä½œã‚ã†

åŸºæœ¬çš„ãª3Dãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ãŒã§ããŸã®ã§ã€æ¬¡ã¯è‡ªåˆ†ã ã‘ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒœã‚¦ãƒªãƒ³ã‚°å ´ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ã‚¤ãƒ‡ã‚¢ã§æ‹¡å¼µã—ã¦ã¿ã¦ãã ã•ã„ã€‚

### 1. éšœå®³ç‰©ã‚’è¿½åŠ 

ãƒ¬ãƒ¼ãƒ³ä¸Šã«éšœå®³ç‰©ã‚’é…ç½®ã—ã¦ã€ãƒœãƒ¼ãƒ«ã®è»Œé“ã‚’è¤‡é›‘ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§éšœå®³ç‰©ã‚’è¿½åŠ ã§ãã¾ã™ï¼š

```python
def add_obstacles(self):
    """ãƒ¬ãƒ¼ãƒ³ä¸Šã«éšœå®³ç‰©ã‚’è¿½åŠ """
    # ãƒãƒ³ãƒ‘ãƒ¼ï¼ˆãƒ¬ãƒ¼ãƒ³ã®é€”ä¸­ã®éšœå®³ç‰©ï¼‰
    for x_pos in [-2, 2]:
        for y_pos in [5, 15]:
            self.add_cylinder(
                position=(x_pos, y_pos, 1),
                scale=(0.8, 0.8, 2),
                color=(0.7, 0.2, 0.2),  # èµ¤ã£ã½ã„è‰²
                mass=0  # å‹•ã‹ãªã„ã‚ˆã†ã«å›ºå®š
            )
    
    # ãƒ©ãƒ³ãƒ—ï¼ˆå‚¾æ–œã®ã‚ã‚‹éšœå®³ç‰©ï¼‰
    self.add_cube(
        position=(0, 10, 0.5),
        scale=(3, 3, 1),
        color=(0.2, 0.7, 0.2),  # ç·‘ã£ã½ã„è‰²
        mass=0,  # å‹•ã‹ãªã„ã‚ˆã†ã«å›ºå®š
        hpr=(0, 10, 0)  # Xè»¸å›ã‚Šã«10åº¦å‚¾ã‘ã‚‹
    )
```

### 2. ã‚«ã‚¹ã‚¿ãƒ ãƒ”ãƒ³é…ç½®

ç‹¬è‡ªã®ãƒ”ãƒ³é…ç½®ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```python
def setup_custom_pins(self, pattern="standard"):
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ”ãƒ³é…ç½®"""
    # æ—¢å­˜ã®ãƒ”ãƒ³ã‚’ã‚¯ãƒªã‚¢
    self.pins.clear()
    self.initial_pin_positions.clear()
    
    if pattern == "standard":
        # æ¨™æº–çš„ãª10ãƒ”ãƒ³é…ç½®
        self.pin_positions = [
            (0, 0, 0),           # 1ç•ªãƒ”ãƒ³ï¼ˆå…ˆé ­ï¼‰
            (-1, 1, 0), (1, 1, 0),        # 2-3ç•ªãƒ”ãƒ³
            (-2, 2, 0), (0, 2, 0), (2, 2, 0),  # 4-6ç•ªãƒ”ãƒ³
            (-3, 3, 0), (-1, 3, 0), (1, 3, 0), (3, 3, 0),  # 7-10ç•ªãƒ”ãƒ³
        ]
    elif pattern == "diamond":
        # ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰å‹é…ç½®
        self.pin_positions = [
            (0, 0, 0),          # ä¸­å¤®
            (-2, 2, 0), (2, 2, 0), (0, 4, 0), # å‘¨å›²
            (-4, 4, 0), (4, 4, 0), (-2, 6, 0), (2, 6, 0), # å¤–å‘¨
            (0, 8, 0) # æœ€å¥¥
        ]
    elif pattern == "circle":
        # å††å½¢é…ç½®
        self.pin_positions = []
        radius = 3
        for i in range(10):
            angle = 2 * math.pi * i / 10
            x = radius * math.cos(angle)
            y = radius * math.sin(angle) + radius  # ä¸­å¿ƒã‚’å°‘ã—å¥¥ã«ãšã‚‰ã™
            self.pin_positions.append((x, y, 0))
    
    # ãƒ”ãƒ³ã‚’é…ç½®
    for pos in self.pin_positions:
        pin = self.add_cylinder(
            position=(pos[0], pos[1], 1.6),  # é«˜ã•ã‚’èª¿æ•´
            scale=(0.8, 0.8, 3.2),
            color=(1, 1, 1),  # ç™½
            base_point=1,     # åº•é¢ä¸­å¿ƒ
        )
        # ãƒ”ãƒ³ã®å‚ç…§ã¨åˆæœŸä½ç½®ã‚’ä¿å­˜
        self.pins.append(pin)
        self.initial_pin_positions.append(pos)
    
    # æœ€å¤§ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
    self.max_score = len(self.pin_positions)
```

### 3. ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ãƒœã‚¦ãƒªãƒ³ã‚°

ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ã®ã‚ˆã†ãªæ¥½ã—ã„ãƒœã‚¦ãƒªãƒ³ã‚°å ´ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```python
def setup_themed_bowling(self, theme="space"):
    """ãƒ†ãƒ¼ãƒã«åˆã‚ã›ãŸãƒœã‚¦ãƒªãƒ³ã‚°å ´ã®è¨­å®š"""
    if theme == "space":
        # å®‡å®™ãƒ†ãƒ¼ãƒ
        # é‡åŠ›ã‚’ä¸‹ã’ã‚‹
        self.change_gravity(0.3)
        
        # èƒŒæ™¯ã‚’é»’ã«
        self.setBackgroundColor(0, 0, 0)
        
        # å®‡å®™ã®ã‚ˆã†ãªåºŠ
        self.add_cube(
            position=(0, self.lane_length/2 - 5, -0.1),
            scale=(self.lane_width, self.lane_length, 0.2),
            color=(0.1, 0.1, 0.3),  # æš—ã„é’
            mass=0
        )
        
        # æ˜Ÿã®ã‚ˆã†ãªè£…é£¾ï¼ˆç™ºå…‰ã™ã‚‹çƒä½“ï¼‰
        for _ in range(20):
            x = random.uniform(-15, 15)
            y = random.uniform(-10, 30)
            z = random.uniform(5, 15)
            size = random.uniform(0.1, 0.5)
            
            self.add_sphere(
                position=(x, y, z),
                scale=(size, size, size),
                color=(1, 1, 1),  # ç™½
                mass=0
            )
    
    elif theme == "beach":
        # ãƒ“ãƒ¼ãƒãƒ†ãƒ¼ãƒ
        # èƒŒæ™¯ã‚’æ°´è‰²ã«
        self.setBackgroundColor(0.5, 0.8, 1.0)
        
        # ç ‚æµœã®ã‚ˆã†ãªåºŠ
        self.add_cube(
            position=(0, self.lane_length/2 - 5, -0.1),
            scale=(self.lane_width, self.lane_length, 0.2),
            color=(0.9, 0.8, 0.6),  # ç ‚è‰²
            mass=0
        )
        
        # æ³¢ã®ã‚ˆã†ãªè£…é£¾
        for i in range(10):
            x = -self.lane_width/2 - 2 + i * 2
            
            self.add_cylinder(
                position=(x, self.lane_length/2, 0.5),
                scale=(0.5, 0.5, random.uniform(0.5, 1.5)),
                color=(0.7, 0.8, 1.0),  # æ°´è‰²
                mass=0
            )
```

## å®Œæˆã—ãŸãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®å®Ÿè¡Œ

ä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®3Dãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œæˆã§ãã¾ã—ãŸï¼ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¦éŠã‚“ã§ã¿ã¾ã—ã‚‡ã†ï¼š

```python
if __name__ == "__main__":
    # ãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œæˆ
    game = BowlingGame()
    
    # ãƒ†ãƒ¼ãƒè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    # game.setup_themed_bowling("space")
    
    # ã‚«ã‚¹ã‚¿ãƒ ãƒ”ãƒ³é…ç½®ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    # game.setup_custom_pins("diamond")
    
    # éšœå®³ç‰©è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    # game.add_obstacles()
    
    # ã‚²ãƒ¼ãƒ å®Ÿè¡Œ
    game.run()
```

## ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„

3Dã‚²ãƒ¼ãƒ ã‚’ä½œã‚‹ã¨ãã«å½¹ç«‹ã¤ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„ã‚’ã„ãã¤ã‹ç´¹ä»‹ã—ã¾ã™ï¼š

1. **ä½ç½®é–¢ä¿‚ã®ç¢ºèª**: ã‚«ãƒ¡ãƒ©ã‚’ç§»å‹•ã—ã¦ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ­£ã—ã„ä½ç½®ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†
2. **ç‰©ç†æŒ™å‹•ã®èª¿æ•´**: é‡åŠ›ä¿‚æ•°ï¼ˆ`gravity_factor`ï¼‰ã‚’å¤‰æ›´ã—ã¦ã€ãƒ”ãƒ³ã®å€’ã‚Œã‚„ã™ã•ã‚’èª¿æ•´ã§ãã¾ã™
3. **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‚ç…§**: `world_manager.body_objects`ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢ã™ã‚‹ã¨ãã¯ã€å‹ã‚„å‚ç…§ã‚’æ…é‡ã«ç¢ºèªã—ã¾ã—ã‚‡ã†
4. **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ´»ç”¨**: `print`æ–‡ã‚’ä½¿ã£ã¦ã€å¤‰æ•°ã®å€¤ã‚„å‡¦ç†ã®æµã‚Œã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒæœ‰åŠ¹ã§ã™

## ã¾ã¨ã‚ï¼šä»Šå›å­¦ã‚“ã ã“ã¨

1. **3Dãƒœãƒ¼ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã®åŸºæœ¬å®Ÿè£…**: ãƒœã‚¦ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒ³ã€ãƒ”ãƒ³ã€ãƒœãƒ¼ãƒ«ã®é…ç½®ã¨ç‰©ç†æŒ™å‹•
2. **ã‚¹ã‚³ã‚¢è¨ˆç®—**: å€’ã‚ŒãŸãƒ”ãƒ³ã‚’æ¤œå‡ºã—ã€å¾—ç‚¹ã‚’è¨ˆç®—ã™ã‚‹æ–¹æ³•
3. **ã‚²ãƒ¼ãƒ é€²è¡Œç®¡ç†**: ãƒ•ãƒ¬ãƒ¼ãƒ ã¨æŠ•çƒã‚’ç®¡ç†ã—ã€ã‚²ãƒ¼ãƒ ã®æµã‚Œã‚’åˆ¶å¾¡ã™ã‚‹æ–¹æ³•
4. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³**: ã‚­ãƒ¼å…¥åŠ›ã§è§’åº¦ã‚„ãƒ‘ãƒ¯ãƒ¼ã‚’èª¿æ•´ã™ã‚‹ä»•çµ„ã¿
5. **æ‹¡å¼µæ©Ÿèƒ½ã®å®Ÿè£…**: ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¯¾å¿œã€éšœå®³ç‰©è¿½åŠ ã€ãƒ†ãƒ¼ãƒè¨­å®šãªã©

ã“ã‚Œã‚‰ã‚’å¿œç”¨ã™ã‚Œã°ã€ã•ã‚‰ã«è¤‡é›‘ã§é¢ç™½ã„ã‚²ãƒ¼ãƒ ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## æ¬¡å›äºˆå‘Š

æ¬¡å›ã¯ã€Œç«‹ä½“è¿·è·¯ã‚²ãƒ¼ãƒ ã‚’ä½œã‚ã†ï¼ã€ã‚’ãƒ†ãƒ¼ãƒã«ã€3Dç©ºé–“å†…ã‚’ç§»å‹•ã—ãªãŒã‚‰ç›®æ¨™ã‚’é”æˆã™ã‚‹ã‚²ãƒ¼ãƒ ã®ä½œã‚Šæ–¹ã‚’å­¦ã³ã¾ã™ã€‚ç§»å‹•ã¨è¡çªåˆ¤å®šã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ç›®æ¨™é”æˆã®åˆ¤å®šæ–¹æ³•ã€ã‚²ãƒ¼ãƒ ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹ã®è¨­è¨ˆãªã©ã€ã‚²ãƒ¼ãƒ é–‹ç™ºã®åŸºæœ¬ã‚’ã•ã‚‰ã«æ·±ãæ¢ç©¶ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼

> ğŸ® **å®¿é¡Œï¼ˆã‚„ã£ã¦ã¿ã‚ˆã†ï¼‰**: ä»Šå›ç´¹ä»‹ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å…ƒã«ã€è‡ªåˆ†ã ã‘ã®ãƒœã‚¦ãƒªãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’ä½œã£ã¦ã¿ã‚ˆã†ã€‚éšœå®³ç‰©ã®é…ç½®ã‚„ãƒ”ãƒ³ã®ä¸¦ã³ã‚’å·¥å¤«ã—ãŸã‚Šã€æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚’è¿½åŠ ã—ãŸã‚Šã—ã¦ã€å‹é”ã«è‡ªæ…¢ã§ãã‚‹ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚²ãƒ¼ãƒ ã‚’ç›®æŒ‡ãã†ï¼

---

**ã‚­ãƒ¥ãƒ¼ãƒ‘ã‚¤ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚’æ¥½ã—ã‚‚ã†ï¼æ¬¡å›ã‚‚ãŠæ¥½ã—ã¿ã«ï¼**